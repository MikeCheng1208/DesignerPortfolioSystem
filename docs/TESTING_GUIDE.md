# Admin 後台系統測試指南

本文檔提供完整的測試流程和檢查清單,確保 Admin 後台系統功能正常運作。

## 測試環境

### 開發環境設置

```bash
# 1. 安裝依賴
npm install

# 2. 設置環境變數
cp .env.example .env
# 編輯 .env 設置 JWT_SECRET 和資料庫連線

# 3. 建立初始管理員帳號
npm run seed:admin

# 4. 啟動開發伺服器
npm run dev
```

### 測試帳號

建議建立多個不同角色的測試帳號:

1. **Super Admin** (seed script 建立)
   - Username: admin
   - Password: Admin123
   - 用途: 測試所有功能

2. **Admin** (手動建立)
   - 用途: 測試一般管理員權限

3. **Editor** (手動建立)
   - 用途: 測試編輯者權限

## 階段一:認證功能測試

### 1.1 登入測試

**測試案例:**

| 案例 | 輸入 | 預期結果 |
|------|------|---------|
| 正確登入 | 有效帳號密碼 | 成功登入,導向儀表板 |
| 錯誤密碼 | 正確帳號 + 錯誤密碼 | 顯示錯誤訊息 |
| 錯誤帳號 | 不存在的帳號 | 顯示錯誤訊息 |
| 空欄位 | 帳號或密碼為空 | 提示必填欄位 |
| 停用帳號 | 已停用的帳號 | 顯示帳號已停用訊息 |
| 帳號鎖定 | 5 次錯誤登入 | 顯示帳號鎖定 15 分鐘訊息 |

**測試步驟:**

```
1. 開啟 http://localhost:3001/admin/login
2. 輸入帳號: admin
3. 輸入密碼: Admin123
4. 點擊「登入」按鈕
5. ✓ 應該顯示成功訊息並導向 /admin/dashboard
6. ✓ 右上角應顯示使用者名稱和頭像
```

**錯誤處理測試:**

```
1. 輸入正確帳號 + 錯誤密碼
2. 點擊登入
3. ✓ 應該顯示「帳號或密碼錯誤」
4. ✓ 登入失敗次數應增加 (查看資料庫)

5. 連續 5 次輸入錯誤密碼
6. ✓ 第 5 次應顯示「帳號已被鎖定 15 分鐘」
7. ✓ 在鎖定期間無法登入

8. 等待 15 分鐘或手動修改資料庫 lockedUntil
9. ✓ 應該可以重新登入
```

### 1.2 登出測試

```
1. 登入後,點擊右上角使用者選單
2. 點擊「登出」
3. ✓ 應該顯示登出成功訊息
4. ✓ 導向登入頁面
5. ✓ Cookie 應該被清除

6. 嘗試訪問 /admin/dashboard
7. ✓ 應該自動導向登入頁面
```

### 1.3 Session 持久性測試

```
1. 登入系統
2. 重新整理頁面
3. ✓ 應該保持登入狀態
4. ✓ 使用者資訊正確顯示

5. 關閉瀏覽器
6. 重新開啟並訪問 /admin/dashboard
7. ✓ 7 天內應該仍保持登入狀態
```

## 階段二:權限控制測試

### 2.1 角色權限測試

**Super Admin 權限:**
```
✓ 可查看所有選單項目
✓ 可建立、編輯、刪除所有內容
✓ 可管理使用者(包括刪除)
```

**Admin 權限:**
```
✓ 可查看除使用者管理外的所有選單
✓ 可建立、編輯內容
✓ 可查看使用者列表
✓ 可建立、編輯使用者
✗ 不可刪除使用者
```

**Editor 權限:**
```
✓ 可查看個人資料、作品、技能、聯絡資訊
✓ 可編輯內容
✗ 不可查看使用者管理
✗ 不可刪除內容
```

### 2.2 導航選單測試

```
測試不同角色登入:

Super Admin:
✓ 儀表板
✓ 個人資料
✓ 作品管理
✓ 技能管理
✓ 聯絡資訊
✓ 使用者管理

Editor:
✓ 儀表板
✓ 個人資料
✓ 作品管理
✓ 技能管理
✓ 聯絡資訊
✗ 使用者管理 (不顯示)
```

### 2.3 API 權限測試

使用 Thunder Client / Postman 測試:

```bash
# 未登入訪問受保護的 API
GET /api/admin/users
預期: 401 Unauthorized

# Editor 嘗試刪除使用者
DELETE /api/admin/users/{id}
預期: 403 Forbidden
```

## 階段三:儀表板測試

### 3.1 統計資訊測試

```
1. 登入並查看儀表板
2. ✓ 作品總數正確顯示
3. ✓ 已發布/草稿數量正確
4. ✓ 技能總數正確顯示
5. ✓ 可見/隱藏技能數量正確
6. ✓ 使用者總數正確顯示
7. ✓ 啟用/停用使用者數量正確
```

### 3.2 使用者資訊卡片測試

```
1. 檢查使用者資訊卡片
2. ✓ 帳號名稱正確
3. ✓ Email 正確
4. ✓ 顯示名稱正確
5. ✓ 角色正確(含顏色標籤)
6. ✓ 最後登入時間正確
7. ✓ 帳號狀態正確
8. ✓ 權限列表正確顯示
```

### 3.3 最近活動測試

```
1. 建立新作品
2. 重新整理儀表板
3. ✓ 新作品應出現在「最近更新的作品」

4. 新增使用者並登入
5. 原管理員重新整理儀表板
6. ✓ 新使用者應出現在「最近登入的使用者」
```

### 3.4 快速連結測試

```
點擊每個快速連結卡片:
1. ✓ 個人資料 -> 導向 /admin/profile
2. ✓ 作品管理 -> 導向 /admin/projects
3. ✓ 技能管理 -> 導向 /admin/skills
4. ✓ 聯絡資訊 -> 導向 /admin/contact
5. ✓ 使用者管理 -> 導向 /admin/users (僅 Super Admin/Admin)
```

## 階段四:個人資料管理測試

### 4.1 查看個人資料

```
1. 前往 /admin/profile
2. ✓ 姓名正確顯示
3. ✓ 職稱正確顯示
4. ✓ Email 正確顯示
5. ✓ 位置正確顯示
6. ✓ Bio 陣列正確顯示
7. ✓ Social Links 正確顯示
```

### 4.2 編輯個人資料

```
1. 修改姓名
2. 點擊儲存
3. ✓ 應顯示成功訊息
4. ✓ 資料應更新

5. 新增 Bio 項目
6. 點擊儲存
7. ✓ 新項目應被保存

8. 刪除 Bio 項目
9. 點擊儲存
10. ✓ 項目應被刪除

11. 新增 Social Link
12. ✓ 應正確保存

13. 修改 Social Link
14. ✓ 應正確更新

15. 刪除 Social Link
16. ✓ 應正確刪除
```

### 4.3 驗證測試

```
1. 清空必填欄位
2. 嘗試儲存
3. ✓ 應顯示驗證錯誤訊息

4. 輸入無效的 Email 格式
5. ✓ 應提示 Email 格式錯誤
```

## 階段五:作品管理測試

### 5.1 作品列表測試

```
1. 前往 /admin/projects
2. ✓ 顯示所有作品列表
3. ✓ 搜尋功能正常
4. ✓ 狀態篩選功能正常(全部/已發布/草稿)
5. ✓ 桌面版顯示表格
6. ✓ 行動版顯示卡片

測試搜尋:
1. 輸入作品標題關鍵字
2. ✓ 列表應即時篩選
3. ✓ 清空搜尋應顯示全部

測試篩選:
1. 選擇「已發布」
2. ✓ 只顯示已發布的作品
3. ✓ 草稿不應顯示
```

### 5.2 新增作品測試

```
1. 點擊「新增作品」
2. 填寫表單:
   - Project ID: test-project
   - Title: 測試作品
   - Slug: test-project (自動同步)
   - Category: Web Design
   - Year: 2024
   - Description: 測試描述
   - Tags: React, TypeScript
3. 上傳圖片(假資料)
4. 點擊「建立作品」
5. ✓ 應顯示成功訊息
6. ✓ 導向編輯頁面
7. ✓ 列表中應出現新作品
```

### 5.3 編輯作品測試

```
1. 點擊作品的編輯按鈕
2. 修改標題
3. 新增標籤
4. 修改描述
5. 點擊「儲存變更」
6. ✓ 應顯示成功訊息
7. ✓ 資料應更新
8. ✓ 前台網站應同步更新
```

### 5.4 發布狀態切換測試

```
在列表頁:
1. 切換作品的發布狀態開關
2. ✓ 應立即更新
3. ✓ 標籤應改變顏色
4. ✓ 前台網站應同步更新

在編輯頁:
1. 修改發布狀態
2. 點擊儲存
3. ✓ 應正確更新
```

### 5.5 刪除作品測試

```
1. 點擊刪除按鈕
2. ✓ 應顯示確認對話框
3. 點擊「取消」
4. ✓ 應關閉對話框,不刪除

5. 再次點擊刪除
6. 點擊「確認刪除」
7. ✓ 應顯示成功訊息
8. ✓ 列表中應移除該作品
9. ✓ 前台網站應同步更新
```

### 5.6 圖片上傳測試(假資料)

```
1. 點擊「新增圖片」
2. ✓ 應添加 Picsum 隨機圖片
3. ✓ 圖片應正確顯示

4. 點擊「移除」
5. ✓ 圖片應被移除

6. 新增多張圖片
7. 拖曳排序
8. ✓ 順序應正確保存
```

## 階段六:技能管理測試

### 6.1 技能列表測試

```
1. 前往 /admin/skills
2. ✓ 顯示所有技能分類
3. ✓ 每個分類顯示技能列表
4. ✓ 顯示可見性狀態
```

### 6.2 新增技能分類測試

```
1. 點擊「新增技能分類」
2. 填寫表單:
   - 名稱: Frontend
   - 技能: React, Vue, Nuxt
3. 點擊「建立」
4. ✓ 應顯示成功訊息
5. ✓ 列表中應出現新分類
```

### 6.3 編輯技能測試

```
1. 點擊編輯按鈕
2. 修改名稱
3. 新增技能項目
4. 刪除技能項目
5. 點擊「儲存」
6. ✓ 應正確更新
```

### 6.4 排序測試

```
1. 點擊「上移」按鈕
2. ✓ 項目應向上移動
3. ✓ 順序應保存

4. 點擊「下移」按鈕
5. ✓ 項目應向下移動
6. ✓ 順序應保存
```

### 6.5 可見性切換測試

```
1. 切換「可見」開關
2. ✓ 應立即更新
3. ✓ 前台網站應同步更新(隱藏/顯示)
```

### 6.6 刪除技能測試

```
1. 點擊刪除按鈕
2. ✓ 應顯示確認對話框
3. 確認刪除
4. ✓ 應從列表移除
```

## 階段七:聯絡資訊管理測試

### 7.1 查看聯絡資訊

```
1. 前往 /admin/contact
2. ✓ Email 正確顯示
3. ✓ 電話正確顯示
4. ✓ 地址正確顯示
5. ✓ 社交連結列表正確顯示
```

### 7.2 編輯基本資訊測試

```
1. 修改 Email
2. 修改電話
3. 修改地址
4. 點擊「儲存變更」
5. ✓ 應顯示成功訊息
6. ✓ 資料應更新
7. ✓ 前台網站應同步更新
```

### 7.3 管理社交連結測試

```
新增連結:
1. 輸入標題 (e.g., "GitHub")
2. 輸入 URL (e.g., "https://github.com/username")
3. 輸入圖標 (e.g., "i-heroicons-code-bracket")
4. 點擊「新增」
5. ✓ 連結應添加到列表

編輯連結:
1. 修改現有連結
2. 點擊儲存
3. ✓ 應正確更新

刪除連結:
1. 點擊「移除」
2. ✓ 連結應從列表移除

排序連結:
1. 使用上移/下移按鈕
2. ✓ 順序應正確保存
```

## 階段八:使用者管理測試

### 8.1 使用者列表測試

```
1. 前往 /admin/users (需 users:read 權限)
2. ✓ 顯示所有使用者
3. ✓ 搜尋功能正常
4. ✓ 顯示角色標籤
5. ✓ 顯示帳號狀態
6. ✓ 顯示最後登入時間
7. ✓ 桌面版顯示表格
8. ✓ 行動版顯示卡片
```

### 8.2 新增使用者測試

```
1. 點擊「新增使用者」(需 users:write 權限)
2. 填寫表單:
   - 帳號: testuser
   - Email: test@example.com
   - 密碼: TestPass123
   - 顯示名稱: Test User
   - 角色: Editor
3. 點擊「建立使用者」
4. ✓ 應顯示成功訊息
5. ✓ 導向編輯頁面
6. ✓ 列表中應出現新使用者
```

### 8.3 密碼驗證測試

```
密碼太短:
1. 輸入少於 8 字元的密碼
2. ✓ 應顯示錯誤訊息

缺少大寫字母:
1. 輸入 "testpass123"
2. ✓ 應提示需包含大寫字母

缺少小寫字母:
1. 輸入 "TESTPASS123"
2. ✓ 應提示需包含小寫字母

缺少數字:
1. 輸入 "TestPassword"
2. ✓ 應提示需包含數字
```

### 8.4 編輯使用者測試

```
1. 點擊使用者的編輯按鈕
2. 修改顯示名稱
3. 修改角色
4. 切換帳號狀態
5. 點擊「儲存變更」
6. ✓ 應顯示成功訊息
7. ✓ 資料應更新
```

### 8.5 重置密碼測試

```
1. 在編輯頁面點擊「重置密碼」
2. 輸入新密碼: NewPass123
3. 點擊「重置密碼」
4. ✓ 應顯示成功訊息
5. ✓ Modal 應關閉

6. 登出並使用新密碼登入
7. ✓ 應該可以成功登入
```

### 8.6 刪除使用者測試

```
1. 點擊刪除按鈕(需 users:delete 權限)
2. ✓ 應顯示確認對話框
3. 確認刪除
4. ✓ 應顯示成功訊息
5. ✓ 使用者應從列表移除

保護機制:
1. 嘗試刪除自己的帳號
2. ✓ 不應顯示刪除按鈕
```

### 8.7 權限預覽測試

```
1. 在新增/編輯頁面選擇角色
2. ✓ 應顯示該角色的權限列表
3. ✓ Super Admin 顯示「所有權限」
4. ✓ Admin 顯示正確的權限
5. ✓ Editor 顯示正確的權限
```

## 階段九:響應式設計測試

### 9.1 行動裝置測試 (< 768px)

```
側邊欄:
✓ 側邊欄應隱藏
✓ 顯示浮動選單按鈕
✓ 點擊按鈕顯示側邊欄
✓ 點擊遮罩層關閉側邊欄
✓ 切換路由自動關閉側邊欄

表格:
✓ 使用者列表顯示為卡片
✓ 作品列表顯示為卡片
✓ 所有資訊可見
✓ 操作按鈕可正常使用

表單:
✓ 輸入欄位改為單欄排列
✓ 按鈕改為堆疊排列
✓ 所有欄位可正常操作

儀表板:
✓ 統計卡片單欄排列
✓ 最近活動單欄排列
✓ 快速連結單欄排列
```

### 9.2 平板測試 (768px - 1023px)

```
✓ 側邊欄顯示為抽屜式
✓ 表格正常顯示
✓ 表單 2 欄排列
✓ 統計卡片 2 欄排列
```

### 9.3 桌面測試 (>= 1024px)

```
✓ 側邊欄固定顯示
✓ 表格完整顯示所有欄位
✓ 表單最佳化排列
✓ 統計卡片 3 欄排列
```

### 9.4 觸控測試

```
✓ 按鈕大小適合觸控(最小 44x44px)
✓ 下拉選單可正常開啟
✓ Modal 可正常操作
✓ Toggle 開關可正常切換
```

## 階段十:錯誤處理測試

### 10.1 網路錯誤測試

```
1. 開啟 DevTools Network tab
2. 設置為 Offline
3. 嘗試儲存資料
4. ✓ 應顯示網路錯誤訊息

5. 恢復網路
6. 重試操作
7. ✓ 應正常執行
```

### 10.2 伺服器錯誤測試

```
1. 故意觸發 500 錯誤(例如修改 API 程式碼)
2. ✓ 應顯示友好的錯誤訊息
3. ✓ 不應顯示原始錯誤堆疊(生產環境)
```

### 10.3 404 頁面測試

```
1. 訪問不存在的頁面: /admin/nonexistent
2. ✓ 應顯示 404 錯誤頁面
3. ✓ 提供返回首頁按鈕
```

### 10.4 401 自動導向測試

```
1. 手動清除 Cookie
2. 訪問受保護頁面
3. ✓ 應自動導向登入頁面
4. ✓ 顯示需要登入訊息
```

## 階段十一:效能測試

### 11.1 頁面載入時間

```
使用 Chrome DevTools Performance:
1. 開啟 Performance tab
2. 錄製頁面載入
3. ✓ 首次載入 < 3 秒
4. ✓ 後續導航 < 1 秒
```

### 11.2 API 回應時間

```
使用 Network tab:
1. 檢查 API 請求
2. ✓ GET 請求 < 500ms
3. ✓ POST/PUT 請求 < 1s
4. ✓ 複雜查詢 < 2s
```

### 11.3 資料量測試

```
1. 建立 100+ 作品
2. 前往作品列表
3. ✓ 頁面應流暢載入
4. ✓ 搜尋應即時回應

5. 建立 50+ 使用者
6. 前往使用者列表
7. ✓ 頁面應流暢載入
```

## 階段十二:安全性測試

### 12.1 SQL/NoSQL 注入測試

```
嘗試注入:
1. 在搜尋框輸入: ' OR '1'='1
2. ✓ 應被安全處理,不應返回所有資料

3. 在表單輸入: {"$gt": ""}
4. ✓ 應被驗證拒絕
```

### 12.2 XSS 測試

```
嘗試注入腳本:
1. 在作品標題輸入: <script>alert('XSS')</script>
2. 儲存
3. ✓ 腳本應被轉義,不應執行

4. 在描述輸入 HTML
5. ✓ 應被安全處理
```

### 12.3 CSRF 防護測試

```
1. 檢查 Cookie 設置
2. ✓ sameSite 應設為 'lax' 或 'strict'
3. ✓ httpOnly 應為 true
4. ✓ secure 應為 true (生產環境)
```

### 12.4 密碼安全測試

```
1. 檢查資料庫中的密碼
2. ✓ 應為 bcrypt hash,不應是明文
3. ✓ Hash 長度應為 60 字元

4. 嘗試使用弱密碼
5. ✓ 應被拒絕
```

## 檢查清單總表

### 功能測試

- [ ] 登入功能正常
- [ ] 登出功能正常
- [ ] Session 持久性正常
- [ ] 權限控制正確
- [ ] 儀表板統計正確
- [ ] 個人資料 CRUD 正常
- [ ] 作品 CRUD 正常
- [ ] 技能 CRUD 正常
- [ ] 聯絡資訊更新正常
- [ ] 使用者管理正常
- [ ] 密碼重置正常

### 介面測試

- [ ] 行動版 (< 768px) 正常顯示
- [ ] 平板版 (768px - 1023px) 正常顯示
- [ ] 桌面版 (>= 1024px) 正常顯示
- [ ] 所有按鈕可正常點擊
- [ ] 表單驗證正常
- [ ] Modal 正常運作
- [ ] Toast 通知正常顯示

### 錯誤處理

- [ ] 網路錯誤有友好提示
- [ ] 伺服器錯誤有友好提示
- [ ] 404 頁面正確顯示
- [ ] 401 自動導向登入頁

### 效能測試

- [ ] 頁面載入速度合理
- [ ] API 回應時間合理
- [ ] 大量資料處理正常

### 安全性測試

- [ ] 無 SQL/NoSQL 注入漏洞
- [ ] 無 XSS 漏洞
- [ ] CSRF 防護正常
- [ ] 密碼安全存儲

### 跨瀏覽器測試

- [ ] Chrome (最新版)
- [ ] Safari (最新版)
- [ ] Firefox (最新版)
- [ ] iOS Safari (實機)
- [ ] Android Chrome (實機)

## 常見問題排查

### 登入失敗

```
1. 檢查 JWT_SECRET 是否正確設置
2. 檢查資料庫連線
3. 檢查使用者是否存在
4. 檢查密碼 hash 是否正確
```

### API 401 錯誤

```
1. 檢查 Cookie 是否正確設置
2. 檢查 JWT token 是否有效
3. 檢查 token 是否過期
4. 檢查中介軟體是否正確執行
```

### 資料不更新

```
1. 檢查 API 是否成功回應
2. 檢查資料庫是否更新
3. 檢查前端是否重新載入資料
4. 清除快取並重試
```

### 權限問題

```
1. 檢查使用者角色
2. 檢查權限陣列
3. 檢查 hasPermission 函數
4. 重新登入以更新 token
```

## 測試報告範本

```markdown
# 測試報告

**測試日期:** 2024-XX-XX
**測試人員:** XXX
**測試環境:** Development / Production

## 測試結果總覽

- 通過: XX / XX
- 失敗: XX / XX
- 跳過: XX / XX

## 問題清單

### 嚴重問題

1. **問題描述**
   - 重現步驟:
   - 預期結果:
   - 實際結果:
   - 截圖:

### 一般問題

1. ...

### 建議改進

1. ...

## 結論

系統整體穩定性: ✓ 良好 / ⚠ 需改進 / ✗ 不穩定
```

## 自動化測試建議(未來實作)

```bash
# 單元測試
npm run test:unit

# E2E 測試
npm run test:e2e

# 測試覆蓋率
npm run test:coverage
```

**推薦工具:**
- Vitest - 單元測試
- Playwright - E2E 測試
- Testing Library - 元件測試
